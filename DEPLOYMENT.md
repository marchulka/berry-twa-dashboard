# Документация по развертыванию и поддержке

## СОДЕРЖАНИЕ
1. [Конфигурация сервисов](#конфигурация-сервисов)
2. [Переменные окружения](#переменные-окружения)
3. [Настройки Railway](#настройки-railway)
4. [Архитектура проекта](#архитектура-проекта)
5. [Процедуры развертывания](#процедуры-развертывания)
6. [Процедуры бэкапа](#процедуры-бэкапа)
7. [Масштабирование](#масштабирование)
8. [Мониторинг](#мониторинг)
9. [Восстановление](#восстановление)
10. [Диагностика](#диагностика)
11. [Эскалация](#эскалация)
12. [Прогресс разработки](#прогресс-разработки)

## КОНФИГУРАЦИЯ СЕРВИСОВ

### 1. Telegram Bot
```yaml
- План: Hobby
- Цена: $5/месяц
- Ресурсы:
  • CPU: 512 MB
  • RAM: 1 GB
  • Диск: 1 GB
- Настройки:
  • Автоматический деплой
  • Автоматическое масштабирование
  • Мониторинг метрик
```

### 2. TWA Dashboard
```yaml
- План: Hobby
- Цена: $5/месяц
- Ресурсы:
  • CPU: 512 MB
  • RAM: 1 GB
  • Диск: 1 GB
- Настройки:
  • Автоматический деплой
  • Автоматическое масштабирование
  • Мониторинг метрик
```

### 3. PostgreSQL
```yaml
- План: Hobby
- Цена: $5/месяц
- Ресурсы:
  • CPU: 512 MB
  • RAM: 1 GB
  • Диск: 1 GB
- Настройки:
  • Автоматическое резервное копирование
  • Мониторинг метрик
  • Автоматическое масштабирование
```

## ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ

### 1. Telegram Bot
```env
BOT_TOKEN=your_bot_token
WEBAPP_URL=your_webapp_url
DATABASE_URL=your_database_url
```

### 2. TWA Dashboard
```env
REACT_APP_API_URL=your_api_url
REACT_APP_BOT_TOKEN=your_bot_token
```

### 3. PostgreSQL
```env
DATABASE_URL=your_database_url
```

## НАСТРОЙКИ RAILWAY

### 1. Общие настройки
```yaml
- Автоматический деплой
- Автоматическое масштабирование
- Мониторинг метрик
- Резервное копирование
```

### 2. Настройки для каждого сервиса
```yaml
- Telegram Bot:
  • Автоматический деплой
  • Автоматическое масштабирование
  • Мониторинг метрик

- TWA Dashboard:
  • Автоматический деплой
  • Автоматическое масштабирование
  • Мониторинг метрик

- PostgreSQL:
  • Автоматическое резервное копирование
  • Мониторинг метрик
  • Автоматическое масштабирование
```

## АРХИТЕКТУРА ПРОЕКТА

### 1. Компоненты
```mermaid
graph TD
    A[Telegram Bot] --> B[TWA Dashboard]
    A --> C[PostgreSQL]
    B --> C
```

### 2. Взаимодействие
```mermaid
sequenceDiagram
    participant User
    participant Bot
    participant Dashboard
    participant Database

    User->>Bot: Отправляет сообщение
    Bot->>Database: Сохраняет данные
    Bot->>Dashboard: Обновляет интерфейс
    Dashboard->>Database: Получает данные
    Dashboard->>User: Отображает информацию
```

## ПРОЦЕДУРЫ РАЗВЕРТЫВАНИЯ

### 1. Развертывание Telegram Bot
```bash
# 1. Клонировать репозиторий
git clone https://github.com/marchulka/berry-twa-dashboard.git

# 2. Установить зависимости
yarn install

# 3. Создать .env файл
cp .env.example .env

# 4. Настроить переменные окружения
# 5. Запустить приложение
yarn start
```

### 2. Развертывание TWA Dashboard
```bash
# 1. Клонировать репозиторий
git clone https://github.com/marchulka/berry-twa-dashboard.git

# 2. Установить зависимости
yarn install

# 3. Создать .env файл
cp .env.example .env

# 4. Настроить переменные окружения
# 5. Запустить приложение
yarn start
```

### 3. Развертывание PostgreSQL
```bash
# 1. Создать базу данных
createdb berry_twa_dashboard

# 2. Применить миграции
yarn migrate

# 3. Заполнить начальные данные
yarn seed
```

## ПРОЦЕДУРЫ БЭКАПА

### 1. Бэкап базы данных
```bash
# 1. Создать бэкап
pg_dump -U postgres berry_twa_dashboard > backup.sql

# 2. Сохранить бэкап
# 3. Проверить целостность
```

### 2. Восстановление из бэкапа
```bash
# 1. Восстановить бэкап
psql -U postgres berry_twa_dashboard < backup.sql

# 2. Проверить целостность
# 3. Запустить приложение
```

## МАСШТАБИРОВАНИЕ

### 1. Триггеры масштабирования
```yaml
- CPU > 80%
- RAM > 80%
- Диск > 80%
- Количество запросов > 1000/мин
```

### 2. План масштабирования
```yaml
- Увеличить ресурсы
- Добавить реплики
- Настроить балансировку
```

## МОНИТОРИНГ

### 1. Метрики
```yaml
- CPU
- RAM
- Диск
- Количество запросов
- Время ответа
```

### 2. Алерты
```yaml
- CPU > 80%
- RAM > 80%
- Диск > 80%
- Время ответа > 1с
```

## ВОССТАНОВЛЕНИЕ

### 1. Быстрое восстановление
```yaml
- Восстановить бэкап
- Перезапустить сервисы
- Проверить работоспособность
```

### 2. Ручное восстановление
```yaml
- Определить причину
- Исправить проблему
- Восстановить данные
- Перезапустить сервисы
```

## ДИАГНОСТИКА

### 1. Проверка логов
```bash
# 1. Проверить логи
tail -f logs/app.log

# 2. Анализировать ошибки
# 3. Принимать меры
```

### 2. Проверка метрик
```bash
# 1. Проверить метрики
# 2. Анализировать тренды
# 3. Принимать меры
```

## ЭСКАЛАЦИЯ

### 1. Контакты
```yaml
- Разработчик: @marchulka
- DevOps: @marchulka
- Поддержка: @marchulka
```

### 2. Процесс эскалации
```yaml
- Определить уровень проблемы
- Связаться с ответственным
- Документировать решение
```

## ПРОГРЕСС РАЗРАБОТКИ

### 1. Журнал изменений
```markdown
#### [2024-03-21] - v0.1.0 - В разработке
- [ ] Подготовка к масштабированию
  - [ ] Контейнеризация
  - [ ] Управление конфигурацией
  - [ ] Модульная архитектура
  - [ ] Хранение данных
  - [ ] Infrastructure as Code

#### [2024-03-21] - v0.1.0 - В разработке
- [ ] Расширенная документация
  - [ ] Архитектурная документация
  - [ ] Операционная документация
  - [ ] Документация для разработки
  - [ ] Метрики и KPI
  - [ ] Runbook'и
```

### 2. Контрольный лист для каждого изменения
```markdown
#### [Название изменения]
1. Планирование:
   - [ ] Анализ текущего состояния
   - [ ] Определение необходимых изменений
   - [ ] Создание плана действий

2. Реализация:
   - [ ] Внесение изменений в код
   - [ ] Обновление документации
   - [ ] Создание коммитов

3. Проверка:
   - [ ] Тестирование функциональности
   - [ ] Проверка документации
   - [ ] Валидация изменений

4. Деплой:
   - [ ] Пуш в репозиторий
   - [ ] Проверка деплоя
   - [ ] Мониторинг после деплоя
```

### 3. Шаблон для новых изменений
```markdown
## [Дата] - [Название изменения]

### Описание
[Краткое описание изменений]

### Изменённые файлы
- [ ] file1
- [ ] file2
- [ ] file3

### Проверки
- [ ] Код соответствует стандартам
- [ ] Документация обновлена
- [ ] Тесты пройдены
- [ ] Деплой успешен

### Примечания
[Важные замечания или проблемы]
```

### 4. Правила документации
```markdown
1. Каждое изменение должно быть задокументировано
2. Обновлять DEPLOYMENT.md после каждого значимого изменения
3. Проверять актуальность документации перед каждым деплоем
4. Включать в документацию:
   - Описание изменений
   - Причины изменений
   - Влияние на систему
   - Инструкции по откату
```

### 5. Процесс обновления документации
```markdown
1. Перед изменениями:
   - Создать новый раздел в журнале
   - Заполнить контрольный лист
   - Подготовить шаблон изменений

2. Во время изменений:
   - Отмечать выполненные пункты
   - Добавлять важные замечания
   - Обновлять статус

3. После изменений:
   - Проверить полноту документации
   - Обновить статус в журнале
   - Сделать коммит с документацией
``` 